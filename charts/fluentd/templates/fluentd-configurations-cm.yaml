{{- if .Values.fileConfigs }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
  labels:
    {{- include "fluentd.labels" . | nindent 4 }}
data:
{{- range .Values.fileConfigs }}
  {{- . | toYaml | nindent 2 }}
{{- end }}
{{- end }}

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-main
  labels:
    {{- include "fluentd.labels" . | nindent 4 }}
data:
  fluent.conf: |-
    # do not collect fluentd logs to avoid infinite loops.
    <label @FLUENT_LOG>
      <match **>
        @type null
        @id ignore_fluent_logs
      </match>
    </label>

    @include config.d/*.conf
    {{- if .Values.defaultConfigs.prometheusConf.enabled }}
    {{- print "@include fluentd-prometheus-conf.d/*"  | nindent 4 }}
    {{- end}}
    {{- if .Values.defaultConfigs.systemdConf.enabled }}
    {{- print "@include fluentd-systemd-conf.d/*"  | nindent 4 }}
    {{- end}}
    {{- range $key := .Values.configMapConfigs }}
    {{- print "@include " $key ".d/*"  | nindent 4 }}
    {{- end }}
